#!/bin/bash

. /opt/forklift/lib/forklift

fetch_image() {
  curl \
    -k \
    -f \
    -H "X-Auth-Token: ${WAREHOUSE_TOKEN}" \
    https://${WAREHOUSE_IP}:7410/blobs/${BUILD_ID}.tgz \
  | gunzip --stdout
}

# parse args and set values
for i in "${@}"; do

  case $i in
    build_id=* )
      BUILD_ID=${i#*=}
      ;;
    warehouse_token=* )
      WAREHOUSE_TOKEN=${i#*=}
      ;;
    warehouse_ip=* )
      WAREHOUSE_IP=${i#*=}
      ;;
  esac

done

fetch_image